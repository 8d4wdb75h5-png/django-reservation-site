{% load static %}
<!DOCTYPE html>
<html lang="ja">
<head>
  <link rel="stylesheet" href="{% static 'reservations/style.css' %}">
</head>
<body>
  <div class="container">
    <p class="sub">
      管理画面で作った予約枠を一覧表示し、空きがあれば予約できます（満席は予約不可）。
      予約はPOST+DBロックで二重予約を防止しています。
    </p>

    <ul class="feature">
      <li>予約枠一覧（DB連携）</li>
      <li>満席制御（残り０は予約不可）</li>
      <li>予約処理（POST）</li>
      <li>二重予約（transaction + select_for_update）</li>
    </ul>

    <ul>
      {% for slot in slots %}
          <li class="card">
            <div>
              <div class="slot-time">
                {{ slot.date }} {{slot.time }}
              </div>
              <div class="badge">
                残り:{{ slot.capacity }}
              </div>
            </div>

            <div style="margin-top: 10px;">
              {% if slot.capacity > 0 %}
                <form action="{% url 'reservations:reserve' slot.id %}" method="post" style="display: inline;">
                  {% csrf_token %}
                  <button type="submit" class="btn btn-green">予約する</button>
                </form>
              {% else %}
                <button class="btn btn-gray" disabled>満席</button>
              {% endif %}
            </div>
          </li>
      {% empty %}
        <li>まだ枠がありません</li>
      {% endfor %}
    </ul>
  </div>
</body>
</html>
