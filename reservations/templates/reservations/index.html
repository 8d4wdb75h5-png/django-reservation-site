{% load static %}
<!DOCTYPE html>
<html lang="ja">
<head>
  <link rel="stylesheet" href="{% static 'reservations/style.css' %}">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>äºˆç´„ã‚µã‚¤ãƒˆ</title>

  <!-- Bootstrap CSS -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />

  <!-- è‡ªä½œCSS -->
  <link rel="stylesheet" href="{% static 'reservations/css/base.css' %}">
  <link rel="stylesheet" href="{% static 'reservations/css/layout.css' %}">
  <link rel="stylesheet" href="{% static 'reservations/css/booking.css' %}">
  <link rel="stylesheet" href="{% static 'reservations/css/admin.css' %}">

  <!-- flatpickr (CDN) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/ja.js"></script>

</head>

<body class="bg-light">

  <main class="container py-4">
    <!-- å…¨ä½“ã‚’ä¸­å¤®å¯„ã›ã«ã™ã‚‹å¹…ï¼ˆ2æšç›®ã¿ãŸã„ã«ï¼‰ -->
    <div class="mx-auto" style="max-width: 980px;">

      <!-- âœ… ã“ã“ã ã‘ç™½ã„æ ï¼ˆäºˆç´„ä¸€è¦§ã€œäºŒé‡äºˆç´„ï¼‰ -->
      <section class="bg-white border rounded-4 shadow-sm p-4 p-md-5 mb-4 intro-card">
        <h1 class="h3 fw-bold mb-3">äºˆç´„æ ä¸€è¦§</h1>

        <!-- ã“ã“ã‚’ç°è‰²ã« -->
        <p class=" mb-3 description-line mb-3">
          ç®¡ç†ç”»é¢ã§ä½œã£ãŸäºˆç´„æ ã‚’ä¸€è¦§è¡¨ç¤ºã—ã€ç©ºããŒã‚ã‚Œã°äºˆç´„ã§ãã¾ã™ï¼ˆæº€å¸­ã¯äºˆç´„ä¸å¯ï¼‰ã€‚<br>
          äºˆç´„ã¯POSTï¼‹DBãƒ­ãƒƒã‚¯ã§äºŒé‡äºˆç´„ã‚’é˜²æ­¢ã—ã¦ã„ã¾ã™ã€‚
        </p>

        <!-- ç›®ç«‹ãŸãªãã¦ã„ã„æ‰€ã¯è–„ã‚ã« -->
        <ul class="feature-list mb-0">
          <li>äºˆç´„æ ä¸€è¦§ï¼ˆDBé€£æºï¼‰</li>
          <li>æº€å¸­åˆ¶å¾¡ï¼ˆæ®‹ã‚Š0ã¯äºˆç´„ä¸å¯ï¼‰</li>
          <li>äºˆç´„å‡¦ç†ï¼ˆPOSTï¼‰</li>
          <li>äºŒé‡äºˆç´„ï¼ˆtransaction + select_for_updateï¼‰</li>
        </ul>
      </section>

      <!-- æ—¥ä»˜ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ï¼ˆç™½æ ã¨ã¯åˆ¥ï¼‰ -->
      <section class="bg-white border rounded-4 shadow-sm p-3 p-md-4 mb-4">
        <form method="get" class="row g-2 align-items-end">
          <div class="col-12 col-md-7">
            <label for="date-picker" class="form-label small text-muted mb-1">æ—¥ä»˜</label>
            <input
              id="date-picker"
              type="text"
              name="date"
              placeholder="æ—¥ä»˜ã‚’é¸æŠ"
              value="{{ qdate|date:'Y-m-d' }}"
              class="form-control"
              autocomplete="off"
            />
          </div>

          <div class="col-12 col-md-auto">
            <button type="submit" class="btn btn-primary w-100">è¡¨ç¤º</button>
          </div>

          <div class="col-12 col-md-auto">
            <a href="{% url 'reservations:index' %}" class="btn btn-outline-secondary w-100">ãƒªã‚»ãƒƒãƒˆ</a>
          </div>
        </form>
      </section>

      <!-- Python(Django) -> JS ã«æ¸¡ã™é…åˆ—ï¼ˆè¶…é‡è¦ï¼‰ -->
      {{ available_dates|json_script:"available-dates" }}

      <!-- äºˆç´„æ ä¸€è¦§ -->
      <section class="d-grid gap-3">
        {% for slot in slots %}
          <div class="bg-white border rounded-4 shadow-sm p-3 p-md-4 d-flex justify-content-between align-items-center">
            <div>
              <!-- ç›®ç«‹ãŸã›ã‚‹ -->
              <div class="slot-datetime">
                  <span class="slot-date">
                      {{ slot.date|date:"Yå¹´næœˆjæ—¥(D)" }}
                  </span>
                  <span class="slot-time">ğŸ•’
                      {{ slot.time|time:"H:i" }}
                  </span>
              </div>
              <!-- è–„ã‚ -->
              <div class="small text-muted">
                æ®‹ã‚Š {{ slot.remaining }} æ 
              </div>
            </div>

            <div>
              {% if slot.is_full %}
                  <button class="btn btn-secondary px-4 rounded-pill" disabled>
                    æº€å¸­
                  </button>     
              {% else %}
               <form method="post" action="{% url 'reservations:reserve' slot.id %}">
                {% csrf_token %}
                <div class="mb-2">
                  <select name="people" class="form-select form-select-sm">
                    {% for i in "123456789"|make_list %}
                      {% if forloop.counter <= slot.remaining %}
                        <option value="{{ forloop.counter }}">
                          {{ forloop.counter}}äºº
                        </option>
                      {% endif %}
                    {% endfor %}
                  </select> 
                </div>
                <button type="submit" class="btn reserve-btn px-4 rounded-pill">
                  äºˆç´„ã™ã‚‹
                </button>
               </form>
              {% endif %}
            </div>
          </div>
        {% empty %}
          <div class="bg-white border rounded-4 shadow-sm p-4 text-center text-muted">
            ã“ã®æ¡ä»¶ã®äºˆç´„æ ã¯ã‚ã‚Šã¾ã›ã‚“
          </div>
        {% endfor %}
      </section>

    </div>
  </main>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- flatpickr -->
  <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/ja.js"></script>

  <!-- è‡ªä½œJS -->
  <script defer src="{% static 'reservations/js/datepicker.js' %}"></script>

</body>
</html>
